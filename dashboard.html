<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>PET Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="sidebar">
  <h2>PET Dashboard</h2>
  <button onclick="goAdmin()">Admin Panel</button>
</div>

<div id="main">
  <div id="profile" class="card">
    <img id="avatar" src="" alt="Avatar">
    <p>Brugernavn: <span id="username"></span></p>
    <p>Afdeling: <span id="department"></span></p>
    <p>Rolle: <span id="role"></span></p>
    <p>Admin: <span id="admin"></span></p>
  </div>

  <div id="messages-section" class="card">
    <h2>Offentlige Beskeder</h2>
    <div id="messages-list"></div>
  </div>
</div>

<script>
let messages = []; // Kan deles med admin i memory

async function initDashboard() {
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  const token = params.get("access_token");
  if(!token){ alert("Log ind med Discord!"); window.location.href="index.html"; return; }

  const userResponse = await fetch("https://discord.com/api/users/@me",{ headers:{ Authorization:`Bearer ${token}` }});
  const userData = await userResponse.json();

  const whitelistResp = await fetch("users.json");
  const whitelist = await whitelistResp.json();

  const userInfo = whitelist[userData.id];
  if(!userInfo){ alert("Ingen adgang!"); window.location.href="index.html"; return; }

  // Udfyld profil
  document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
  document.getElementById("username").textContent = userData.username;
  document.getElementById("department").textContent = userInfo.department;
  document.getElementById("role").textContent = userInfo.role;
  document.getElementById("admin").textContent = userInfo.admin ? "Ja" : "Nej";

  messages = userInfo.messages || [];
  renderMessages();
}

function renderMessages(){
  const list = document.getElementById("messages-list");
  list.innerHTML="";
  messages.forEach(msg=>{
    const div=document.createElement("div");
    div.textContent = msg;
    list.appendChild(div);
  });
}

function goAdmin(){
  const hash = window.location.hash;
  const token = hash;
  window.location.href = `admin.html${token}`;
}

initDashboard();
</script>
</body>
</html>
